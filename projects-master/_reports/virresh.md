---
categories:
  - GSoC
  - 2018
  - StatusReport
student: Viresh Gupta
date: 2018-08-12
organisation: coala
organisation_link : https://coala.io
project: Integrate ANTLR v4 to coala
project_link: https://summerofcode.withgoogle.com/projects/#6067962113425408
report_year: 2018
tarball: https://github.com/virresh/GSoC-18_Report/raw/master/patches.tar
sha256sum: 43cd5aaf56b735abf34bba8fbf9f83f2cba716c9f20f76c3954228887f61e220
mentors: >
  [Dong-hee Na](https://github.com/corona10) &
  [Udayan Tandon](https://github.com/Udayan12167)
phase:
  - Bonding : https://gitlab.com/coala/GSoC/GSoC-2018/milestones/37
  - Phase 1 : https://gitlab.com/coala/GSoC/GSoC-2018/milestones/38
  - Phase 2 : https://gitlab.com/coala/GSoC/GSoC-2018/milestones/39
  - Phase 3 : https://gitlab.com/coala/GSoC/GSoC-2018/milestones/40
bio: >
  Hi ! I am Viresh Gupta, an undergrad student at Indraprastha Institute of 
  Information Technology, Delhi, India. I love coding in and out and like to
  lay my hands on whatever tech I can find. I also love to read books, observe
  nature and star gaze in my free time. I chose coala for my GSoC project
  because I think it's awesome to be able to push my friends a friendly reminder
  to indent their code properly, and programmatically detect when they went lazy
  in doing so, which helps me to focus on the main logic when working on a team
  project.
social:
  - GitHub:
    - username: virresh
    - link: https://github.com/virresh
  - GitLab:
    - username: virresh
    - link: https://gitlab.com/virresh
  - Gitter:
    - username: virresh
    - link: https://gitter.im/virresh
  - Openhub:
    - username: virresh
    - link: https://www.openhub.net/accounts/virresh
email: viresh16118@iiitd.ac.in
blog: https://virresh.wordpress.com/
activity:
  - 1:
      - repo: cEPs
      - link: https://github.com/coala/cEPs/commit/49c6cec2
      - details: >
          "cEP-0018: Integration of ANTLR in coala"
  - 2:
      - repo: cEPs
      - link: https://github.com/coala/cEPs/commit/b8a17299
      - details: >
          "cEP-0018.md: Add information about fixes"
  - 3:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/f51addcf
      - details: >
          "Initial Commit"
  - 4:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/168263a2
      - details: >
          "ci: Integrate inital ci test"
  - 5:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/9671f083
      - details: >
          "setup.py: Make package installable"
  - 6:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/f8067834
      - details: >
          "Implement a loader for parse trees"
  - 7:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/c80200d2
      - details: >
          "Initial walkers implemented,"
  - 8:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/d8146003
      - details: >
          "core: Add ASTBear and Implement quote spacing bear"
  - 9:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/8bbea04b
      - details: >
          ".gitlab-ci.yml: Add job for bear run testing"
  - 10:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/1249762a
      - details: >
          "PyQuoteSpacingBear: Fix for implicit string concatenation"
  - 11:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/e5f2d83d
      - details: >
          ".gitlab-ci: Add moban check"
  - 12:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/85cbb026
      - details: >
          "Add initial tests"
  - 13:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/7845dec4
      - details: >
          "Change the library logic for visiting"
  - 14:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/8067ab45
      - details: >
          "Add pytest with 100% coverage"
  - 15:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/ec3c90c2
      - details: >
          ".coafile: Add initial coafile"
  - 16:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/8fd5a04a
      - details: >
          "setup.py: Add entrypoint for bear discovery"
  - 17:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/fa4bab87
      - details: >
          "PyQuoteSpacingBearTest.py: Add tests for slash"
  - 18:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/8334960e
      - details: >
          "PyPluralNamingBear: Add Bear"
  - 19:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/1f6df970
      - details: >
          "MANIFEST: Add manifest and housekeeping"
  - 20:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/5a6e3a50
      - details: >
          "Py3Walker: Use NodeData for get_quote_content"
  - 21:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/bbff6752
      - details: >
          "Add sphinx docs"
  - 22:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/7c91ad6e
      - details: >
          "Add coantbears docs"
  - 23:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/cbea3e7f
      - details: >
          "Add docs for gitlab pages"
  - 24:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/b2166a24
      - details: >
          "Add bears metadata and refactor dependencies"
  - 25:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/bc7cf18f
      - details: >
          "ASTLoader: Workaround for python"
  - 26:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/7d7d7e4f
      - details: >
          "ASTLoader.py: Add check for empty files"
  - 27:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/074c96ba
      - details: >
          "coantlib: Move all generated files"
  - 28:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/179bb8a8
      - details: >
          "commonutils.py: Extract common utilities"
  - 29:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/3af8d13e
      - details: >
          ".coafile: Add PyDocStyleBear"
  - 30:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/1a348b4e
      - details: >
          ".gitlab-ci.yml: Add git installation"
  - 31:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/ba4adcdb
      - details: >
          "coantlib: Generalise entrypoint"
  - 32:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/72e2bb72
      - details: >
          "tests: Remove hashbangs"
  - 33:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/abc9f3b0
      - details: >
          "Python3.py: Make parser PEP8 compliant"
  - 34:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/bfa10282
      - details: >
          "ASTBear: Remove redundant `lang` argument"
  - 35:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/27891c28
      - details: >
          "XMLIndentBear: Add XMLIndentBear"
  - 36:
      - repo: coala-antlr
      - link: https://gitlab.com/coala/bears/coala-antlr/commit/a8a7f6eb
      - details: >
          ".ci: Add check for XML Upstream grammar"
  - 37:
      - repo: coala
      - link: https://github.com/coala/coala/commit/d936d162
      - details: >
          "XML.py: Add language definition for XML"
  - 38:
      - repo: community
      - link: https://github.com/coala/community/commit/7e5cd645
      - details: >
          ".coafile: Add PyPluralNamingBear"
  - 39:
      - repo: coala-quickstart
      - link: https://github.com/coala/coala-quickstart/commit/bf587786
      - details: >
          "appveyor.yml: Use pip as a module"
  - 40:
      - repo: coala-quickstart
      - link: https://github.com/coala/coala-quickstart/commit/99ad0910
      - details: >
          "test-requirements.txt: Add packaging"
  - 41:
      - repo: coala-bears
      - link: https://github.com/coala/coala-bears/commit/97e98900
      - details: >
          "GitCommitBear: Refactor issue regexes"
  - 42:
      - repo: coala-bears
      - link: https://github.com/coala/coala-bears/commit/33cd9e41
      - details: >
          "GitCommitBear: Add BitBucket type issue references"
  - 43:
      - repo: coala-bears
      - link: https://github.com/coala/coala-bears/commit/985217dc
      - details: >
          "HgCommitBear: Switch to git-url-parse"
  - 44:
      - repo: projects
      - link: https://github.com/coala/projects/commit/a8f0e9b0
      - details: >
          "report.md: Make GSoC year dynamic"
  - 45:
      - repo: coala-mobans
      - link: https://gitlab.com/coala/mobans/commit/76ebb40c
      - details: >
          "appveyor.yml.jj2: Add template for appveyor config"
  - 46:
      - repo: git-url-parse
      - link: https://github.com/retr0h/git-url-parse/commit/ab464224
      - details: >
          "conftest.py: Add test for BitBucket style git url"
  - 47:
      - repo: grammars-v4
      - link: https://github.com/antlr/grammars-v4/pull/1205
      - details: >
          "Python3.g4: Add support for newer python features"

---

## Integrate ANTLR with coala

This project is about integrating ANTLR with coala. coala is a one stop linter,
which provides unified API to lint several languages, and it also provides an
API to create our own Analysis over code.
ANTLR is ANother Tool for Language Recognition, which helps us to create parse
trees and provides api for traversing those parse trees.

This project aims to combine the capabilities of the two tools which will
enable coala users to write advanced analysis logic using parse trees and
vastly improve the capabilities of Native Bears of coala (Native bears do not
depend on any external linting tools).

As an outcome of this project, coala will be able to support any arbitrary
language, provided there exists a grammar for it, and thus this project is a
step towards the future of native bear development with coala.  

Library availaible at: <https://gitlab.com/coala/bears/coala-antlr>  
Docs hosted at: <https://virresh.gitlab.io/coala-antlr/>  

### Work Done

##### coala-antlr

A library for integrating ANTLR with coala was created and as a proof of
utility, few analysis tools were created for ``Python`` language, and one of them
was also put to Production for improved maintenance. A bear for analysing ``XML``
language is also ready and acts as an example of the capabilities of this library to
support multiple grammars.

``PyQuoteSpacingBear`` - This bear checks for trailing spaces in all the strings in
a python source code.

``PyPluralNamingBear`` - This bear enforces variables that have been assigned to a
list or a dictionary to have a plural name.

``XMLIndentBear`` - This bear will analyse indents in an XML file and suggest
appropriate fixes for getting tags to indent at same level.

This library is now usable by bear writers for writing native bears for coala
while leveraging the power of ANTLR.
(All commits included as diff patches in the tarball)

##### antlr-v4-grammars

Some issues were identified with the upstream grammars and were reported, along
with suggested corrections as PR. 
[Link](https://github.com/antlr/grammars-v4/issues/created_by/virresh)

##### community

Add `PyPluralNamingBear` to repo, for confirming the feasibility and ease of
use of the library.

##### coala

Minor enhancements were made such as adding a language definition for XML,
which `coala-antlr` requires for it's ``XMLIndentBear``.

##### coala-mobans

Added a template for standardising appveyor CI configurations across repos.

##### coala-bears

Added support for Mercurial via a HgCommitBear.
Enhanced existing GitCommitBear with improved logging.

All contributions apart from `coala-antlr` repo present as diff patches of
commits.

### Challenges

Major challenge in the project for me was to come up with a library design 
that's flexible enough to support all grammars, and yet powerful enough to
leverage all features provided by a grammar.

I was guided by my mentor Dong-hee and my org admin John through important
design decisions and they helped me to come up with a flexible design.

The other major challenge was using grammars that are directly from the
upstream grammars repository. Several errors were identified in the upstream
repository and we had to find out workarounds for most issues. This is a more
prominent problem for places where we needed to provide a fix for the linting
issue identified.

### Work to be done

The library is up and ready to roll, although by itself it won't be much
useful unless people use it to write bears for coala. So the future work
on this library would involve having lots of bears written for various grammars

Also enhancements possible in the library would involve a mechanism that
would help the bear writers to suggest complex fixes easily, although this
would probably have to wait until `antlr` supports tree rewriting or
workarounds are discovered to deal with source code retrieval from parse tree.

Another possible enhancement in the library would be the feature of on-demand
grammar download, which essentially means we would be able to make the process
of adding more languages to `coala-antlr` easier, by not having to worry about
adding parsers and lexers manually when a language is added for the first time.
